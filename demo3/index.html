<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=9,chrome=1">
    <title>Pxxl.js demopage</title>
    <link rel="stylesheet" href="demo.css">
  </head>
  <body>

  <div id="stage" class="stage"></div>

  <div class="footer">
   see the <a href="https://github.com/remcoder/Pxxl.js">Pxxl.js Github repo</a> for tha codez
   <span class="right">&copy; 2012 <a href="http://twitter.com/remcoder">@remcoder</a></span>
  </div>


  <pre class="code"></pre>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

    <script src="../build/pxxl-0.3.min.js" type="text/javascript"></script>

    <script type="text/javascript" id="code">

var stage = document.querySelector("#stage");

pxxl("../fonts/c64.bdf", "Cubes!", function (pixels) {
  var shape = new Shape(stage);

  var cubes = [];

  for (var p=0 ; p<pixels.length ; p++) {
    var pixel = pixels[p];
    var cube = new Cube(shape, { size: 24, x: pixel.x, y: pixel.y });
    cubes.push(cube);
  }

  // setTimeout(function () {
  //   shape.el.classList.add("rotate-x");
  // },400);


  setTimeout(function () { shape.el.classList.add("rotate-y"); animate(cubes);},400);
  explode(cubes);

});

// just set the transformation once every couple of seconds. css transitions will do the rest
function animate(cubes) {
  makeLetters(cubes);
  setTimeout(function() {
    explode(cubes);
    setTimeout(function() { animate(cubes); }, 3000);
  }, 6000);
}

function r(factor) { return (Math.random()-0.5) * factor; };
function translate3d(x,y,z) { return "translate3d("+x+"px,"+y+"px,"+z+"px)";}

function Side(cube, which, options) {
  this.el = document.createElement("div");
  this.el.classList.add("shape");

  this.el.style.width = this.el.style.height = options.size + "px";
  var h = 250 + (Math.random()-0.5) * 100;
  this.el.style.backgroundColor = "hsla("+h+",100%,50%,0.5)";
  this.el.style.border = "1px solid black";
  cube.el.appendChild(this.el);

  var t = 0.5* options.size;

  switch(which)
  {
    case "front":
      this.el.style.webkitTransform = translate3d(0,0,t);
      break;
    case "right":
      this.el.style.webkitTransform = translate3d(t,0,0) + "rotateY(90deg)";
      break;
    case "top":
      this.el.style.webkitTransform = translate3d(0,t,0) + "rotateX(-90deg)";
      break;
    case "back":
      this.el.style.webkitTransform = translate3d(0,0,-t) + "rotateX(180deg)";
      break;
    case "left":
      this.el.style.webkitTransform = translate3d(-t,0,0) + "rotateY(-90deg)";
      break;
    case "bottom":
      this.el.style.webkitTransform = translate3d(0,-t,0) + "rotateX(90deg)";
      break;
  }
}

function Cube(shape, options) {

  this.el = document.createElement("div");
  this.el.classList.add("shape");

  this.size = options.size;
  this.x = options.x;
  this.y = options.y;

  this.el.style.width = this.el.style.height = options.size + "px";



  new Side(this, "front", options);
  new Side(this, "left", options);
  new Side(this, "right", options);

  new Side(this, "top", options);
  new Side(this, "bottom", options);
  new Side(this, "back", options);

  shape.el.appendChild(this.el);
}

Cube.prototype.setTransform = function (x,y,z) {
  this.el.style.webkitTransform = translate3d(x,y,z);
}

function Shape(stage) {
  this.el = document.createElement("div");
  this.el.classList.add("shape");
  stage.appendChild(this.el);
}

function makeLetters(cubes) {
  for (var p=0 ; p<cubes.length ; p++) {

    var cube = cubes[p];
    var dx = -4*6;
    var dy = -4;

    var x = cube.size * (dx+cube.x);
    var y = cube.size * (dy+cube.y);
    cube.el.style.webkitTransition = "-webkit-transform 2s ease-in";
    cube.setTransform(x,y,0);
  }
}

function explode(cubes) {
  for (var p=0 ; p<cubes.length ; p++) {

    var cube = cubes[p];

    cube.el.style.webkitTransition = "-webkit-transform 2s ease-out";
    cube.setTransform(r(1000), r(1000), r(1000));
  }
}


    </script>
    <script>
     document.querySelector("pre").innerText = document.getElementById("code").innerText;
    </script>
  </body>
</html>
